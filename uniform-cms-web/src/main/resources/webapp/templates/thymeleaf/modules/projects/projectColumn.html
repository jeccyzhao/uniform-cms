<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout/default/layout" th:with="subTitle=${project.name}, menu='columns'">
	
<th:block layout:fragment="content">
    <div class="col-md-2">
        <th:block layout:include="modules/projects/menu/projectMenu"/>
    </div>
    <div class="col-md-10">
        <div class="panel panel-shadow panel-blue-cap">
            <div class="panel-heading panel-heading-transparent">
                <h1 th:text="'\'' + ${project.name} + '\' Columns'" style="line-height: 30px"></h1>
            </div>
            <div class="panel-body" style="padding: 0 10px 20px 10px;">
                <div class="pannel-toolbar" style="overflow: hidden">
                    <div style="float: left;">
                        <a href="#" class="btn btn-icon-button"
                           data-backdrop="true" data-toggle="modal" id="op_add">
                            <span class="icon icon-add"></span><span>Create</span>
                        </a>
                    </div>
                </div>
                <div id="table-filter" class="grid-alternating-rows n-table-hover n-jqxgrid-table n-grid-paging "></div>
            </div>
        </div>
    </div>

    <div th:include="modules/projects/popup/popupProjectColumn"></div>

    <script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/
        $(function () {
            loadData("table-filter");
            $("#op_add").click(function() { showPopupDialog('m_projectColumn'); });
        });

        function loadData(container_id) {
            var projectId = /*[[${project.id}]]*/;
            $.ajax(openApiContextPath + "/projects/" + projectId + "/columns", {
                    data: {},
                    type: 'GET',
                    success: function(rsp) {
                    var ret = eval(rsp);
                    if (ret.data != null) {
                        initJqxTable(container_id, constructColumns(), rebuildColumnData(ret.data), true);
                    }

                    disableAjaxLoading();
                },
                beforeSend: function(){
                    enableAjaxLoading("Loading Data...");
                },
                error: function(rsp) {
                    disableAjaxLoading();
                }
            });
        }

        function constructColumns () {
            var columns = [
                {text: 'ID', datafield: 'id', hidden: true},
                {text: 'Visible', datafield: 'visible', cellsalign:'center', align: 'center', width: 60},
                {text: 'Column Name', datafield: 'columnName', cellsalign: 'left', align: 'center', filterable: true},
                {text: 'Column Remark', datafield: 'columnRemark', cellsalign: 'left', align: 'center', filterable: true},
                {text: 'Example', datafield: 'columnDataExample', cellsalign: 'left', align: 'center', filterable: true},
                {text: 'Column Length', datafield: 'columnLength', cellsalign:'center', align: 'center', width: 130, filterable: true},
                {text: 'Order', datafield: 'seq', cellsalign:'center', align: 'center', width: 80},
                {text: 'S', columntype: 'textbox', datafield: 'edit', width: 24, filterable: false, editable: false, sortable: false},
                {text: 'U', columntype: 'textbox', datafield: 'undo', width: 24, filterable: false, editable: false, sortable: false},
                {text: 'D', columntype: 'textbox', datafield: 'delete', width: 24, filterable: false, editable: false, sortable: false}
            ];
            return columns;
        }

        function rebuildColumnData(data) {
            if (data != null) {
                for (var i = 0; i < data.length; i++) {
                    if (data[i].visible != null) {
                        data[i].visible = "<div class='n-cell-icon'><span title='" +
                            (data[i].visible == 0 ? "Invisible" : "Visible") + "' class='icon icon-fault-" +
                            (data[i].visible == 0 ? "unknown" : "cleared") + "'></span></div>";
                    }

                    data[i].undo = '<div class="n-row-indicated" onclick="showColumnUpdate();" title="Undo"><span class="icon icon-undo"></span></div>';
                    data[i].edit = '<div class="n-row-indicated" onclick="showColumnUpdate();" title="Save"><span class="icon icon-save-as"></span></div>';
                    data[i].delete = '<div class="n-row-indicated" onclick="showColumnUpdate();" title="Delete"><span class="icon icon-delete"></span></div>';
                }
            }
            return data;
        }

        function showColumnUpdate() {
            var rowData = getCurrentGridRowData("table-filter");
            if (rowData != null) {

            }
        }

        /*]]>*/
    </script>
</th:block>
</html>