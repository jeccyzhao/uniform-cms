!function(a){"function"==typeof define&&define.amd?define(["angular","../const/constants"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("angular"):require("angular")(b)),a(c,require("../const/constants")),c}:a(angular)}(function(a){"use strict";var b=function(b,c,d,e){var f,g,h,i,j=this;"function"!=typeof CustomEvent?(f=document.createEvent("CustomEvent"),f.initCustomEvent("show.wulf.combobox",!1,!1,{message:"before show"}),h=document.createEvent("CustomEvent"),h.initCustomEvent("hide.wulf.combobox",!1,!1,{message:"before hide"}),g=document.createEvent("CustomEvent"),g.initCustomEvent("shown.wulf.combobox",!1,!1,{message:"after show"}),i=document.createEvent("CustomEvent"),i.initCustomEvent("hidden.wulf.combobox",!1,!1,{message:"after hide"})):(f=new CustomEvent("show.wulf.combobox"),h=new CustomEvent("hide.wulf.combobox"),g=new CustomEvent("shown.wulf.combobox"),i=new CustomEvent("hidden.wulf.combobox")),this.isOpen=!1,this.comboboxClass=[],this.dropdownWidth=0,this.selectedItemText="",this.selectedItemValue="";var k=function(){setTimeout(function(){j.isOpen&&j.close()},0)},l=function(a,b){return(" "+a.className+" ").replace(/[\n\t]/g," ").indexOf(" "+b+" ")>-1},m=function(a){var b=a.prop("tagName");"BUTTON"===b?j.isTextfield(j.pattern)?j.dropdownWidth=a.parent().parent()[0].clientWidth:j.isMenu(j.pattern)&&(j.dropdownWidth=a.parent().find("button")[0].clientWidth+a[0].clientWidth+2):"SPAN"===b&&(j.isTextfield(j.pattern)?j.dropdownWidth=a.parent().parent().parent()[0].clientWidth:j.isMenu(j.pattern)&&void 0!==a.parent().attr("class")&&(j.dropdownWidth=a.parent().parent().find("button")[0].clientWidth+a.parent()[0].clientWidth+2))};this.isTextfield=function(a){return"textfield"===a||"clearable-textfield"===a},this.isMenu=function(a){return"menu"===a||"sm-menu"===a},void 0===this.pattern&&(this.pattern="textfield"),void 0===this.disable&&(this.disable=!1),this.isTextfield(this.pattern)?(this.comboboxClass.push("input-group"),this.comboboxClass.push("combobox")):this.isMenu(this.pattern)&&(this.comboboxClass.push("btn-group"),this.comboboxClass.push("n-combobutton"),"sm-menu"===this.pattern&&this.comboboxClass.push("n-combobutton-small")),this.open=function(){document.dispatchEvent(f),this.isOpen=!0,d(function(){b.on("click",k)},0),document.dispatchEvent(g)},this.close=function(){document.dispatchEvent(h),this.isOpen=!1,d(function(){b.off("click",k)},0),document.dispatchEvent(i)},this.toggle=function(b){var c=a.element(b.target),d=c.prop("tagName");"INPUT"===d?this.close():("BUTTON"===d||"SPAN"===d||"A"===d)&&(this.isOpen?this.close():(m(c),this.open()))},this.keyboardStepInList=function(b){var c=b.keyCode,d=a.element(b.target);if(c===e.DOWN){if(l(b.target,"dropdown-toggle")){b.preventDefault();for(var f=d.parent().find("ul").find("li"),g=0;g<f.length;g++)if(!f.eq(g).find("a")[0].disabled){f.eq(g).find("a")[0].focus();break}}}else c===e.ESC&&this.close()},this.clearContent=function(b){var c=b.keyCode,d=a.element(b.target);c===e.SPACE?(b.preventDefault(),this.selectedItemText="",d.parent().find("input")[0].focus()):void 0===c&&(this.selectedItemText="",d.parent().parent().find("input")[0].focus())}};b.$inject=["$document","$element","$timeout","WF-KEYCODE-CONST"];var c=function(b,c){var d,e=this;"function"!=typeof CustomEvent?(d=document.createEvent("CustomEvent"),d.initCustomEvent("selected.wulf.combobox",!1,!1,{message:"selected item"})):d=new CustomEvent("selected.wulf.combobox"),void 0===this.disable&&(this.disable=!1),void 0===this.selected&&(this.disable=!1),void 0===this.itemText&&(this.itemText=this.itemValue),this.init=function(){this.selected&&(this.parent.selectedItemValue=this.itemValue,void 0===this.itemText?this.parent.selectedItemText=this.itemValue:this.parent.selectedItemText=this.itemText)},c(function(){e.init()},0),this.selectItem=function(b){this.parent.toggle(b);var c=a.element(b.target);this.selected=!0,this.parent.selectedItemValue=this.itemValue,this.parent.selectedItemText=this.itemText;var e=null;this.parent.isTextfield(this.pattern)?(e=c.parent().parent().parent().parent().find("button")[0],void 0===e&&(e=c.parent().parent().parent().parent().parent().parent().find("button")[0]),e.focus()):this.parent.isMenu(this.pattern)&&(e=c.parent().parent().parent().parent().parent().find("button")[1],void 0===e&&(e=c.parent().parent().parent().parent().parent().parent().parent().find("button")[1]),e.focus()),document.dispatchEvent(d)},this.keyboardNavigation=function(c){var d=c.keyCode,e=a.element(c.target),g=e.parent(),h=!1;switch(d){case b.UP:h=!1,f(c,g,h);break;case b.DOWN:h=!0,f(c,g,h);break;case b.SPACE:c.preventDefault(),this.selectItem(c);break;case b.ESC:c.preventDefault(),this.parent.close()}};var f=function(a,b,c){a.preventDefault();var d=b.parent().parent().find("li"),e=i(b,d,c);null!==e&&h(d,e)},g=function(a,b){return a[b].firstElementChild},h=function(a,b){var d=g(a,b);c(function(){d.focus()},0)},i=function(a,b,c){var d=j(a,b),e=null,f=0;if(c){for(f=++d;f<b.length;f++)if(!b[f].firstElementChild.disabled){e=f;break}}else for(f=--d;f>=0;f--)if(!b[f].firstElementChild.disabled){e=f;break}return e},j=function(a,b){for(var c=null,d=0;d<b.length;d++)b[d]===a[0]&&(c=d);return c}};c.$inject=["WF-KEYCODE-CONST","$timeout"],a.module("wf.angular.combobox",["wf.angular.constants"]).component("wfCombobox",{transclude:!0,templateUrl:"wf/ng-template/combobox/combobox.html",bindings:{pattern:"<",disable:"<?"},controller:b}).component("wfComboboxItem",{transclude:!0,templateUrl:"wf/ng-template/combobox/item.html",require:{parent:"^^wfCombobox"},bindings:{itemValue:"<",itemText:"<",disable:"<?",selected:"<?"},controller:c})});