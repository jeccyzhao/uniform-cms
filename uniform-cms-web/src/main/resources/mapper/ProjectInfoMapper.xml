<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nokia.ucms.biz.repository.ProjectInfoRepository">

    <resultMap type="ProjectInfo" id="rs_project">
        <id property="id" column="id"/>
        <result property="name" column="p_name"/>
        <result property="description" column="p_description"/>
        <result property="owner" column="p_owner"/>
        <result property="tableName" column="p_tablename"/>
        <result property="state" column="p_state"/>
        <result property="creationTime" column="p_creationTime" />
    </resultMap>

    <select id="getProjectInfoByName" parameterType="java.lang.String" resultMap="rs_project">
        SELECT * FROM `t_project` WHERE `p_name` = #{projectName}
    </select>

    <select id="getProjectInfoById" parameterType="java.lang.Integer" resultMap="rs_project">
        SELECT * FROM `t_project` WHERE `id` = #{projectId}
    </select>

    <select id="getAllProject" resultMap="rs_project">
        SELECT * FROM `t_project`
    </select>

    <select id="getProjectInfoByTableName" resultMap="rs_project">
        SELECT * FROM `t_project` WHERE `p_tablename` = #{tableName}
    </select>

    <insert id="addProjectInfo" parameterType="ProjectInfo" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `t_project` (`p_name`, `p_description`, `p_owner`, `p_tablename`, `p_state`, `p_creationTime`)
            VALUES (#{name}, #{description}, #{owner}, #{tableName}, #{state}, #{creationTime})
    </insert>

    <update id="updateProjectInfo">
        UPDATE `t_project`
        <set>
            <if test="name != null and name != ''">`p_name` = #{name},</if>
            <if test="description != null and description !=''">`p_description` = #{description},</if>
            <if test="state != null and state > -1">`p_state` = #{state},</if>
            `id` = `id`
        </set>
        WHERE `id` = #{id}
    </update>

    <delete id="removeProjectInfo">
        DELETE FROM `t_project` WHERE `id` = #{projectId} ORDER BY `p_creationTime` DESC
    </delete>

</mapper>